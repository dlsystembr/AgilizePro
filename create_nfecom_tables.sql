-- Criar tabela NFECOM_CAPA (Cabeçalho da NFCom)
CREATE TABLE IF NOT EXISTS `nfecom_capa` (
    `NFC_ID` INT(11) NOT NULL AUTO_INCREMENT,
    `NFC_CUF` VARCHAR(2) NOT NULL COMMENT 'Código da UF',
    `NFC_TIPO_AMBIENTE` TINYINT(1) NOT NULL DEFAULT 2 COMMENT '1=Produção, 2=Homologação',
    `NFC_MOD` VARCHAR(2) NOT NULL DEFAULT '62' COMMENT 'Modelo NFCom',
    `NFC_SERIE` VARCHAR(3) NOT NULL DEFAULT '1' COMMENT 'Série',
    `NFC_NNF` INT(9) NOT NULL COMMENT 'Número da NF',
    `NFC_CNF` VARCHAR(8) NOT NULL COMMENT 'Código Numérico',
    `NFC_CDV` VARCHAR(1) NOT NULL COMMENT 'Dígito Verificador',
    `NFC_DHEMI` DATETIME NOT NULL COMMENT 'Data/Hora Emissão',
    `NFC_TP_EMIS` TINYINT(1) NOT NULL DEFAULT 1 COMMENT 'Tipo Emissão',
    `NFC_N_SITE_AUTORIZ` INT(3) NOT NULL DEFAULT 0 COMMENT 'Site Autorizador',
    `NFC_C_MUN_FG` VARCHAR(7) NOT NULL COMMENT 'Código Município',
    `NFC_FIN_NFCOM` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'Finalidade NFCom',
    `NFC_TP_FAT` TINYINT(1) NOT NULL DEFAULT 0 COMMENT 'Tipo Faturamento',
    `NFC_VER_PROC` VARCHAR(20) NOT NULL DEFAULT '1.0.0' COMMENT 'Versão Processo',
    `NFC_CNPJ_EMIT` VARCHAR(14) NOT NULL COMMENT 'CNPJ Emitente',
    `NFC_IE_EMIT` VARCHAR(14) NOT NULL COMMENT 'IE Emitente',
    `NFC_CRT_EMIT` TINYINT(1) NOT NULL COMMENT 'Código Regime Tributário',
    `NFC_X_NOME_EMIT` VARCHAR(60) NOT NULL COMMENT 'Nome Emitente',
    `NFC_X_FANT_EMIT` VARCHAR(60) NULL COMMENT 'Nome Fantasia',
    `NFC_X_LGR_EMIT` VARCHAR(60) NOT NULL COMMENT 'Logradouro Emitente',
    `NFC_NRO_EMIT` VARCHAR(60) NULL COMMENT 'Número Emitente',
    `NFC_X_CPL_EMIT` VARCHAR(60) NULL COMMENT 'Complemento Emitente',
    `NFC_X_BAIRRO_EMIT` VARCHAR(60) NOT NULL COMMENT 'Bairro Emitente',
    `NFC_C_MUN_EMIT` VARCHAR(7) NOT NULL COMMENT 'Código Município Emitente',
    `NFC_X_MUN_EMIT` VARCHAR(60) NOT NULL COMMENT 'Nome Município Emitente',
    `NFC_CEP_EMIT` VARCHAR(8) NOT NULL COMMENT 'CEP Emitente',
    `NFC_UF_EMIT` VARCHAR(2) NOT NULL COMMENT 'UF Emitente',
    `NFC_FONE_EMIT` VARCHAR(14) NULL COMMENT 'Telefone Emitente',
    `NFC_X_NOME_DEST` VARCHAR(60) NOT NULL COMMENT 'Nome Destinatário',
    `NFC_CNPJ_DEST` VARCHAR(14) NOT NULL COMMENT 'CNPJ Destinatário',
    `NFC_IND_IE_DEST` TINYINT(1) NOT NULL DEFAULT 9 COMMENT 'Indicador IE Destinatário',
    `NFC_X_LGR_DEST` VARCHAR(60) NOT NULL COMMENT 'Logradouro Destinatário',
    `NFC_NRO_DEST` VARCHAR(60) NULL COMMENT 'Número Destinatário',
    `NFC_X_BAIRRO_DEST` VARCHAR(60) NOT NULL COMMENT 'Bairro Destinatário',
    `NFC_C_MUN_DEST` VARCHAR(7) NOT NULL COMMENT 'Código Município Destinatário',
    `NFC_X_MUN_DEST` VARCHAR(60) NOT NULL COMMENT 'Nome Município Destinatário',
    `NFC_CEP_DEST` VARCHAR(8) NOT NULL COMMENT 'CEP Destinatário',
    `NFC_UF_DEST` VARCHAR(2) NOT NULL COMMENT 'UF Destinatário',
    `NFC_I_COD_ASSINANTE` VARCHAR(14) NOT NULL COMMENT 'Código Assinante',
    `NFC_TP_ASSINANTE` TINYINT(1) NOT NULL COMMENT 'Tipo Assinante',
    `NFC_TP_SERV_UTIL` TINYINT(1) NOT NULL COMMENT 'Tipo Serviço Utilizado',
    `NFC_N_CONTRATO` VARCHAR(20) NOT NULL COMMENT 'Número Contrato',
    `NFC_D_CONTRATO_INI` DATE NOT NULL COMMENT 'Data Início Contrato',
    `NFC_V_PROD` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Produtos',
    `NFC_V_COFINS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor COFINS',
    `NFC_V_PIS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor PIS',
    `NFC_V_FUST` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor FUST',
    `NFC_V_FUNTEL` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor FUNTTEL',
    `NFC_V_RET_PIS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Retenção PIS',
    `NFC_V_RET_COFINS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Retenção COFINS',
    `NFC_V_RET_CSLL` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Retenção CSLL',
    `NFC_V_IRRF` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor IRRF',
    `NFC_V_RET_TRIB_TOT` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Retenção Tributária Total',
    `NFC_V_DESC` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Desconto',
    `NFC_V_OUTRO` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Outros',
    `NFC_V_NF` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor NF',
    `NFC_COMPET_FAT` VARCHAR(6) NOT NULL COMMENT 'Competência Faturamento',
    `NFC_D_VENC_FAT` DATE NOT NULL COMMENT 'Data Vencimento Faturamento',
    `NFC_D_PER_USO_INI` DATE NOT NULL COMMENT 'Data Período Uso Início',
    `NFC_D_PER_USO_FIM` DATE NOT NULL COMMENT 'Data Período Uso Fim',
    `NFC_COD_BARRAS` VARCHAR(50) NULL COMMENT 'Código Barras',
    `NFC_INF_CPL` TEXT NULL COMMENT 'Informações Complementares',
    `NFC_STATUS` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '0=Rascunho, 1=Salvo, 2=Enviado, 3=Autorizado, 4=Rejeitado',
    `NFC_CH_NFCOM` VARCHAR(44) NULL COMMENT 'Chave NFCom',
    `NFC_N_PROT` VARCHAR(15) NULL COMMENT 'Número Protocolo',
    `NFC_DH_RECBTO` DATETIME NULL COMMENT 'Data/Hora Recebimento',
    `NFC_C_STAT` VARCHAR(3) NULL COMMENT 'Código Status',
    `NFC_X_MOTIVO` VARCHAR(255) NULL COMMENT 'Motivo',
    `NFC_DIG_VAL` VARCHAR(28) NULL COMMENT 'Digest Value',
    `NFC_XML` LONGTEXT NULL COMMENT 'XML Gerado',
    `NFC_DATA_CADASTRO` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `NFC_DATA_ATUALIZACAO` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`NFC_ID`),
    INDEX `idx_nfecom_status` (`NFC_STATUS`),
    INDEX `idx_nfecom_chave` (`NFC_CH_NFCOM`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Tabela de Cabeçalho da NFCom';

-- Criar tabela NFECOM_ITENS (Itens da NFCom)
CREATE TABLE IF NOT EXISTS `nfecom_itens` (
    `NFI_ID` INT(11) NOT NULL AUTO_INCREMENT,
    `NFC_ID` INT(11) NOT NULL COMMENT 'ID da NFCom (FK)',
    `NFI_N_ITEM` INT(3) NOT NULL COMMENT 'Número Item',
    `NFI_C_PROD` VARCHAR(60) NOT NULL COMMENT 'Código Produto',
    `NFI_X_PROD` VARCHAR(120) NOT NULL COMMENT 'Descrição Produto',
    `NFI_C_CLASS` VARCHAR(7) NOT NULL COMMENT 'Código Classificação',
    `NFI_CFOP` VARCHAR(4) NOT NULL COMMENT 'CFOP',
    `NFI_U_MED` VARCHAR(6) NOT NULL COMMENT 'Unidade Medida',
    `NFI_Q_FATURADA` DECIMAL(15,4) NOT NULL DEFAULT 0.0000 COMMENT 'Quantidade Faturada',
    `NFI_V_ITEM` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Item',
    `NFI_V_DESC` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Desconto',
    `NFI_V_OUTRO` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Outros',
    `NFI_V_PROD` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor Produto',
    `NFI_CST_ICMS` VARCHAR(3) NULL COMMENT 'CST ICMS',
    `NFI_CST_PIS` VARCHAR(2) NOT NULL DEFAULT '01' COMMENT 'CST PIS',
    `NFI_V_BC_PIS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Base Cálculo PIS',
    `NFI_P_PIS` DECIMAL(5,2) NOT NULL DEFAULT 0.00 COMMENT 'Alíquota PIS',
    `NFI_V_PIS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor PIS',
    `NFI_CST_COFINS` VARCHAR(2) NOT NULL DEFAULT '01' COMMENT 'CST COFINS',
    `NFI_V_BC_COFINS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Base Cálculo COFINS',
    `NFI_P_COFINS` DECIMAL(5,2) NOT NULL DEFAULT 0.00 COMMENT 'Alíquota COFINS',
    `NFI_V_COFINS` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor COFINS',
    `NFI_V_BC_FUST` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Base Cálculo FUST',
    `NFI_P_FUST` DECIMAL(5,2) NOT NULL DEFAULT 0.00 COMMENT 'Alíquota FUST',
    `NFI_V_FUST` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor FUST',
    `NFI_V_BC_FUNTEL` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Base Cálculo FUNTTEL',
    `NFI_P_FUNTEL` DECIMAL(5,2) NOT NULL DEFAULT 0.00 COMMENT 'Alíquota FUNTTEL',
    `NFI_V_FUNTEL` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor FUNTTEL',
    `NFI_V_BC_IRRF` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Base Cálculo IRRF',
    `NFI_V_IRRF` DECIMAL(15,2) NOT NULL DEFAULT 0.00 COMMENT 'Valor IRRF',
    `NFI_DATA_CADASTRO` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `NFI_DATA_ATUALIZACAO` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (`NFI_ID`),
    FOREIGN KEY (`NFC_ID`) REFERENCES `nfecom_capa`(`NFC_ID`) ON DELETE CASCADE,
    INDEX `idx_nfecom_itens_nfcom` (`NFC_ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT='Tabela de Itens da NFCom';